# This params defines a version of provision file
version: 1

servers:
  - name: main_kafka
    type: kafka
    description: "Main Kafka message broker"
    channels:
      - name: emails
      - name: notifications

  - name: rest_api
    type: rest
    description: "REST API server"
    channels:
      - name: user_api
      - name: admin_api

schemas:
  - name: "email_schema"
    type: "jsonschema"
    version: 1
    description: "Schema for email messages"
    schema: "{\"type\":\"object\",\"properties\":{\"to\":{\"type\":\"string\"},\"subject\":{\"type\":\"string\"},\"body\":{\"type\":\"string\"}},\"required\":[\"to\",\"subject\",\"body\"]}"

  - name: "notification_schema"
    type: "jsonschema"
    version: 1
    description: "Schema for notification messages"
    example: "{\"user_id\":\"123\",\"message\":\"Hello world\",\"timestamp\":\"2023-01-01T12:00:00Z\"}"

messages:
  - name: "send_email"
    description: "Message for sending emails"
    schema:
      name: "email_schema"

  - name: "send_notification"
    description: "Message for sending notifications"
    schema:
      name: "notification_schema"

apps:
  - name: "main_backend"
    description: "Main backend application"
    sends:
      - message:
          name: "send_email"
        channel:
          name: "main_kafka.emails"
      - message:
          name: "send_notification"
        channel:
          name: "rest_api.user_api"

  - name: "mailer"
    description: "Email sending service"
    receives:
      - message:
          name: "send_email"
        channel:
          name: "main_kafka.emails"

  - name: "notification_service"
    description: "Notification service"
    receives:
      - message:
          name: "send_notification"
        channel:
          name: "main_kafka.notifications"